# Basic use for my personal.
# 设置服务器ip变量
export SSH_USER="rezo"

# 2018/03/21 - 如果私钥可配置在此处
export SSH_OPT=" -4C"

# 2018/03/21 - 可在zsh中使用这个ip变量
export localhost="192.168.1.254"
export loop="127.0.0.1"

# 2018/03/21 - 注意这个是不会建立alias的
export noalias="127.0.0.1"

# 通过循环这个变量, 设置相应的alias
export SERVERS="localhost
loop"

TMUX_CMD='/usr/local/bin/tmux'
if [ ! -f $TMUX_CMD ]; then
   TMUX_CMD=`whereis tmux | awk '{print $2}'`
fi
if [ -f $TMUX_CMD ]; then
    function ts_startup(){
        local session_name="startup"
        local ps_status=`ps cax | grep tmux`
        local session_ex=`$TMUX_CMD list-sessions 2>/dev/null | grep -o "$session_name"`
        if [ "${ps_status}" = "" ] || [ "$session_ex" = "" ]; then
            tmux new -d -n "default" -s "$session_name"
            return
        fi
    }

    function tsm_localhost(){
        local session_name="monitor"
        local ps_status=`ps cax | grep tmux`
        local session_ex=`$TMUX_CMD list-sessions 2>/dev/null | grep -o "$session_name"`
        if [ "${ps_status}" = "" ] || [ "$session_ex" = "" ]; then
            # 先添加一个本机监控
            tmux new -d -n "default" -s "$session_name" -x 180 -y 200
            tmux neww -d -n "localhost" "systat -vm 1"
            tmux splitw -h -t "localhost" "systat -if 1"
            tmux splitw -h -t "localhost" "top"
            tmux resizep -t 0 -x 80
            tmux resizep -t 1 -x 45
            tmux selectp -t 0
            tmux splitw -v -t "localhost" "systat -io 1"
            # 增加到第二列,注意这里因为前面增加了一个panel, 所以变成了2
            tmux selectp -t 2
            tmux splitw -v -t "localhost" "gstat"
            return
        fi
       if [ "$session_ex" != "" ]; then
            echo "session ${session_name} has exist."
        fi
    }

    local ps_status=`ps cax | grep tmux`
    if [ "${ps_status}" = "" ]; then
        tsm_localhost
        ts_startup
    fi
fi
